

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>全球领先的开放式定位服务平台</title>
    <link rel="Shortcut Icon" href="/Images/favicon.ico" />
    <link href="/content/style.css" rel="stylesheet" type="text/css" />
    <link href="/Scripts/Plugins/ymPrompt/skin/bluebar/ymPrompt.css" type="text/css" rel="stylesheet" />
    <script src="/Scripts/jquery.min.js" type="text/javascript"></script>
    <script src="/Scripts/Plugins/ymPrompt/ymPrompt.js" type="text/javascript"></script>
    <script src="/Scripts/Plugins/toggleLoading/jquery-loading.js" type="text/javascript"></script>
    <script type="text/javascript" language="javascript">
        //防止登录页面被嵌套
        if (top.location != location) {
            top.location.href = location.href;
        }

        //蒙版
        function toggleLoading() {
            $(document.body).toggleLoading();
        }

        var ImgUrl = '/Login/GetIndentifyCode';
        $(function () {
            $(document.body).height(document.documentElement.clientHeight);
            var img = $('#imgIndentifyCode');
            img.attr('src', ImgUrl + "?_t=" + Math.random());
            img.bind("click", function () {
                img.attr("src", ImgUrl + "?_t=" + Math.random());
            });
            $(document).keypress(function (e) {
                if (e.keyCode == 13 && !$('.x-loading-wanghe').is(':visible') && !$('#ym-window').is(':visible')) {
                    validateLogin();
                    return false;
                }
            });

            $(".ie-tx").slideDown(300);
            $('.closed').click(function () {
                $(".ie-tx").hide();
            });
        })

        function validateLogin() {
            var userName = $("#txtUserName");
            var pwd = $("#txtPwd");
            var indentifyCode = $("#txtIndentifyCode");

            if (userName.val() == "") {
                ymPrompt.alert({ message: "请输入用户名！", handler: function () { userName.focus(); } });
                return false;
            }
            if (pwd.val() == "") {
                ymPrompt.alert({ message: "请输入密码！", handler: function () { pwd.focus(); } });
                return false;
            }
            if (indentifyCode.val() == "") {
                ymPrompt.alert({ message: "请输入验证码！", handler: function () { indentifyCode.focus(); } });
                return false;
            }

            var pattern = /^[\w\u4E00-\u9FA5\uF900-\uFA2D]+$/;
            if (pattern.test(userName.val()) == false) {
                ymPrompt.alert({ message: "用户登录名不能包含空格、~!@#$%^&*<>?等等非法字符！", handler: function () { userName.focus(); userName.select(); } });
                return false;
            }
            logonSubmit();
        }

        function logonSubmit() {
            var oJson = {
                username: $('#txtUserName').val(),
                password: $('#txtPwd').val(),
                indentifyCode: $('#txtIndentifyCode').val(),
                savepwd: $('#savepwd').attr('checked')
            };
            toggleLoading();
            $.ajax({
                url: '/Login/LogOnSubmint',
                type: 'POST',
                data: oJson,
                dataType: "text",
                cache: false,
                success: function (result) {
                    if (result.indexOf('|') > -1 && result.split('|')[0] == "error") {
                        $("#txtPwd").val("");
                        $("#txtIndentifyCode").val("");
                        $("#imgIndentifyCode").trigger("click");

                        ymPrompt.alert({ message: result.split('|')[1], handler: function () { $('#txtUserName').select(); } });
                        toggleLoading();
                        return;
                    }
                    else {
                        window.location.href = result;
                    }
                },
                error: function (xhr) {
                    ymPrompt.alert('网络异常，登录失败!');
                    toggleLoading();
                    $("<div style='display:none'></div>").html(xhr).appendTo(document.body);
                }
            });
        }
        //清除输入错误的验证码
        function ClearIndentifyCode() {
            $("#txtIndentifyCode").val('');
            $('#imgIndentifyCode').attr("src", ImgUrl + "?_t=" + Math.random());
        }

        function experienceLogin() {
            toggleLoading();
            $.ajax({
                url: '/Login/ExperienceLogin',
                type: 'POST',
                data: {},
                dataType: "text",
                cache: false,
                success: function (result) {
                    if (result.indexOf('|') > -1 && result.split('|')[0] == "error") {
                        $("#txtPwd").val("");
                        $("#txtIndentifyCode").val("");
                        $("#imgIndentifyCode").trigger("click");
                        $('#txtUserName').select();
                        ymPrompt.alert(result.split('|')[1]);
                        toggleLoading();
                        return;
                    }

                    window.location.href = result;
                },
                error: function (xhr) {
                    ymPrompt.alert('网络异常，登录失败!');
                    toggleLoading();
                    $("<div style='display:none'></div>").html(xhr).appendTo(document.body);
                }
            });
        }

    </script>
</head>
<body style='overflow: hidden;' scroll="no">
    <form action="/" method="post">
    <div id="login">
<!--[if IE 6]>
<div class="ie-tx"><span>为了获得更好的使用体验，请使用IE6以上版本的浏览器！<a target="_blank" href="http://www.firefox.com.cn/download/">火狐浏览器</a><a target="_blank" href="http://www.google.cn/chrome/">Google浏览器</a></span><a class="closed" href="#">关闭</a></div>
<![endif]-->
        
        <div class="login-head">
            <h1>
                车辆监控服务平台</h1>
            <a class="exp" href="javascript:void(0);" onclick='experienceLogin();'>立即体验</a>
        </div>
        <div class="login-box">
            <dl>
                <dt>用户登录</dt>
                <dd>
                    <label>用户名：</label>
                    <input id="txtUserName" type="text" class="tbox" value='' />
                </dd>
                <dd>
                    <label>密 码：</label>
                    <input id="txtPwd" type="password" class="tbox" value='' />
                </dd>
                <dd>
                    <label>验证码：</label><input id="txtIndentifyCode" type="text" value="" maxlength="4" class="tbox code" />
                    <div class="get-code"><img id="imgIndentifyCode" src="" alt="验证码" style="cursor: pointer;" /></div>
                </dd>
                <dd class="rem">
                    <input id="savepwd" type="checkbox" class="chb"  />记住密码
                </dd>
                <dd><input type="button" value="登 录" onclick="validateLogin();" class="btn" /></dd>
            </dl>
        </div>
        
    </div>
    </form>
</body>
</html>
