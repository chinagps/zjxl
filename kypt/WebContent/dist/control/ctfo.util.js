CTFO.Util.CodeManager=function(){function t(){var e="SYS_AREA_INFO",t=!1,n=null,r=function(){t=!1,$.ajax({url:CTFO.config.sources.generalCode,type:"POST",data:{timestamp:(new Date).getTime()},dataType:"json",cache:!1,success:function(e,r){n=$.extend({},generalCode||{},e||{}),CTFO.cache.generalCode=n,t=!0},error:function(e,t){alert("初始化codeManager数据失败 "+e)}})},i=function(){if(!CTFO.config.globalObject.isLoadAlarmTypeDesc)return;$.get(CTFO.config.sources.alarmTypeDesc+"?timestamp="+(new Date).getTime(),null,function(e,t,n){e&&e.length>0&&$(e).each(function(e){CTFO.cache.alarmTypeDesc[this.alarmCode]=this.alarmName})},"json")},s=function(){if(!CTFO.config.globalObject.isLoadCorpList)return;$.ajax({url:CTFO.config.sources.drivdingCorpList,type:"POST",dataType:"json",data:null,complete:function(e,t){},success:function(e,t,n){CTFO.cache.userCorps=e},error:function(e,t,n){}})};return{init:function(){return r(),i(),s(),this},getAlarmDesc:function(e){return CTFO.cache.alarmTypeDesc[e]||""},queryAlarmLevel:function(e,t){var n=e;typeof e=="object"&&(n=e.code.toString());if(!n)return!1;if(CTFO.cache.alarmType[n])return t&&t(CTFO.cache.alarmType[n],e),!1;$.ajax({url:CTFO.config.sources.alarmLevel,type:"POST",dataType:"json",data:{"requestParam.equal.levelId":+n,"requestParam.equal.entId":$.inArray(+CTFO.cache.user.entType,[1,2])>-1?CTFO.cache.user.entId:1},complete:function(e,t){},success:function(r,i,s){!r||(CTFO.cache.alarmType[n]=r,t&&t(r,e))},error:function(e,t,n){}})},getSelectList:function(e,r,i,s){if(t&&e&&n[e]){var s=s||"请选择...",o=['<option value="" title="'+s+'">'+s+"</option>"];$(n[e]).each(function(){var e=i&&i==this.code?"selected":"";o.push('<option value="'+this.code+'" title="'+this.name+'" '+e+">"+this.name+"</option>")}),$(r).html("").append(o.join(""))}},getNameByCode:function(r,i){var s="";return r=r?r:e,t&&r&&i&&n[r]&&$(n[r]).each(function(){i==this.code&&(s=this.name)}),s},getCityProvcodeNameByCode:function(r,i,s){var o="";return r=r?r:e,t&&r&&i&&s&&n[r]&&$(n[r]).each(function(){if(i==this.code){var e=this.children;$(e).each(function(){s==this.code&&(o=this.name)})}}),o},getCityAndProvcodeNameByCode:function(e,t,n){var r="--";return e&&t&&n&&$(n).each(function(){if(e==this.code){r=this.name;var n=this.children;$(n).each(function(){t==this.code&&(r+=this.name)})}}),r},getCityNameByCode:function(r,i){var s="";return r=r?r:e,t&&r&&i&&n[r]&&$(n[r]).each(function(){var e=this.children;$(e).each(function(){i==this.code&&(s=this.name)})}),s},getProvinceList:function(t,r){if(n[e]){var i=['<option value="" title="请选择...">请选择...</option>'];$(n[e]).each(function(){var e=r==this.code?"selected":"";i.push('<option value="'+this.code+'" title="'+this.name+'" '+e+">"+this.name+"</option>")}),$(t).html("").append(i.join(""))}},getCityList:function(t,r,i){var s=['<option value="" title="请选择...">请选择...</option>'];t&&n[e]&&$(n[e]).each(function(){if(t==this.code){var e=this.children;$(e).each(function(){var e=i==this.code?"selected":"";s.push('<option value="'+this.code+'" title="'+this.name+'" '+e+">"+this.name+"</option>")})}}),$(r).html("").append(s.join(""))},getProvAndCity:function(t,r,i,s){var o=this;n[e]&&(this.getProvinceList(t,s),r&&s&&i&&this.getCityList(s,r,i),r&&$(t).change(function(){var e=$(this).val();o.getCityList(e,r,i)}))}}}var e;return{getInstance:function(){return e||(e=t()),e}}}(),CTFO.Util.Date=function(){this.secondToDate=function(e,t){if(!e)return 0;var n="";e>=86400&&(n+=parseInt(e/24/3600)+":",e%=86400),e>=3600&&(n+=parseInt(e/3600)+":",e%=3600),e>=60&&(n+=parseInt(e/60)+":",e%=60),e>0&&(n+=e);var r=n.split(":"),i="",s="",o="",u="",a="";return r.length==1&&(u=r[0]<10?"0"+r[0]:r[0],a=u+"秒"),r.length==2&&(o=r[0]<10?"0"+r[0]:r[0],u=r[1]<10?"0"+r[1]:r[1],a=o+"分"+u+"秒"),r.length==3&&(s=r[0]<10?"0"+r[0]:r[0],o=r[1]<10?"0"+r[1]:r[1],u=r[2]<10?"0"+r[2]:r[2],a=s+"小时"+o+"分"+u+"秒"),r.length==4&&(i=r[0]<10?"0"+r[0]:r[0],s=r[1]<10?"0"+r[1]:r[1],o=r[2]<10?"0"+r[2]:r[2],u=r[3]<10?"0"+r[3]:r[3],a=i+"天"+s+"小时"+o+"分"+u+"秒"),a},this.getFirstMonth=function(){var e=new Date,t=e.getMonth(),n=0,r=parseInt(e.getFullYear(),10);return t==0?(r-=1,n=12):n=t,n<10&&(n="0"+n),r+"-"+n},this.getNowMonth=function(){var e=new Date,t=e.getMonth(),n=0;t==0?n=1:n=t+1;var r=e.getFullYear();return n<10&&(n="0"+n),r+"-"+n},this.getMonthLastDay=function(e){var t=e.substring(0,4),n=e.substring(5,7),r=Number(t),i=Number(n);i++,i>12&&(i-=12,r++);var s=new Date(r,n,1,0,0,0),o=(new Date(s.getTime()-6e4)).getDate();return o.length==1&&(o="0"+o),e=e+"-"+o,e},this.getMonthFirstDay=function(e){var t=e.substring(0,4),n=e.substring(5,7),r=Number(t),i=Number(n);i++,i>12&&(i-=12,r++);var s=new Date(r,n,1,0,0,0),o=(new Date(s.getTime())).getDate();return o==1&&(o="0"+o),e=e+"-"+o,e},this.getFirstMonthDate=function(){var e=new Date,t=e.getMonth(),n=t,r=e.getFullYear(),e=e.getDate()<10?"0"+e.getDate():e.getDate();return n==0?(n=12,r-=1):n<0&&(n=12+n,r-=1),n<10&&(n="0"+n),r+"-"+n+"-"+e},this.getFirstThreeMonth=function(){var e=new Date,t=e.getMonth(),n=t-2,r=e.getFullYear(),e=e.getDate()<10?"0"+e.getDate():e.getDate();return n==0?(n=12,r-=1):n<0&&(n=12+n,r-=1),n<10&&(n="0"+n),r+"-"+n+"-"+e},this.getTodayPrecedeWeek=function(){var e=new Date,t=new Date(e.getTime()-6048e5),n=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();return n},this.getTodayTenWeek=function(){var e=new Date,t=new Date(e.getTime()-12096e5),n=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();return n},this.getYesterdayPrecedeMonth=function(){var e=new Date,t=new Date(e.getTime()-864e5),n=t.getFullYear()+"-"+(t.getMonth()+1)+"-1";return n},this.getNextYearCurrentDay=function(){var e=new Date,t=new Date(e.getTime()+31536e6),n=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();return n},this.getNextYearTommorow=function(e){if(e)var t=new Date(e);else var t=new Date;var n=new Date(t.getTime()+31536e6+864e5),r=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();return r},this.MillisecondToDate=function(e){var t=parseFloat(e)/1e3;if(null!=t&&""!=t)if(t>60&&t<3600){var n=parseInt(t/60);n=n>10?n:"0"+n;var r=parseInt((parseFloat(t/60)-parseInt(t/60))*60);r=r>10?r:"0"+r,t="00:"+n+":"+r}else if(t>=3600&&t<86400){var i=parseInt(t/3600);i=i>10?i:"0"+i;var n=parseInt((parseFloat(t/3600)-parseInt(t/3600))*60);n=n>10?n:"0"+n;var r=parseInt((parseFloat((parseFloat(t/3600)-parseInt(t/3600))*60)-parseInt((parseFloat(t/3600)-parseInt(t/3600))*60))*60);r=r>10?r:"0"+r,t=i+":"+n+":"+r}else{var r=parseInt(t);r=r>10?r:"0"+r,t="00:00:"+r}else t="00:00:00";return t},this.getTomorrow=function(e){if(e)var t=new Date(e);else var t=new Date;var n=new Date(t.getTime()+864e5),r=n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate();return r},this.getCurMonthFirstDay=function(){var e=new Date,t=new Date(e.getTime()-864e5),n=t.getFullYear()+"-"+(t.getMonth()+1)+"-01";return n},this.getYesterday=function(){var e=new Date,t=new Date(e.getTime()-864e5),n=t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate();return n},this.getToday=function(){var e=new Date,t=e.getMonth()+1,n=e.getDate()<10?"0"+e.getDate():e.getDate();t<10&&(t="0"+t);var n=e.getFullYear()+"-"+t+"-"+n;return n},this.dateFormat=function(e,t){var n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var r in n)(new RegExp("("+r+")")).test(t)&&(t=t.replace(RegExp.$1,RegExp.$1.length==1?n[r]:("00"+n[r]).substr((""+n[r]).length)));return t},this.date2utc=function(e){if(!e)return"";var t=new Date(e.replace(/-/g,"/"));return t?t.getTime():""},this.utc2date=function(e){if(!e||e==="null"||e==="无"||+e===0)return"";var t=new Date;t.setTime(parseInt(e,10)+288e5);var n=t.getUTCFullYear()+"-";return t.getUTCMonth()+1<10?n+="0"+(t.getUTCMonth()+1)+"-":n+=t.getUTCMonth()+1+"-",t.getUTCDate()<10?n+="0"+t.getUTCDate():n+=t.getUTCDate(),t.getUTCHours()<10?n+=" 0"+t.getUTCHours()+":":n+=" "+t.getUTCHours()+":",t.getMinutes()<10?n+="0"+t.getUTCMinutes()+":":n+=t.getUTCMinutes()+":",t.getUTCSeconds()<10?n+="0"+t.getUTCSeconds():n+=t.getUTCSeconds(),n},this.time2utc=function(e){var t=e.split(":"),n=t[0]*36e5,r=t[1]*6e4,i=t[2]*1e3;return parseInt(n,10)+parseInt(r,10)+parseInt(i,10)},this.daysBetween=function(e,t,n,r){var i=864e5;!!r&&parseFloat(r)>0&&(i=r);var s=Date.parse(e.replace(/\-/g,"/"))-Date.parse(t.replace(/\-/g,"/"));return n?Math.abs(s)/i:s/i},this.startDateBigerThanEndDate=function(e,t){if(!e||e.length<1||!t||t.length<1)return!0;var n=e.split(" "),r=t.split(" "),i=n[0].split("-"),s=r[0].split("-"),o=n[1].split(":"),u=r[1].split(":"),a=new Date(i[0],parseInt(i[1],10)-1,parseInt(i[2],10),o[0],o[1],o[2]),f=new Date(s[0],parseInt(s[1],10)-1,parseInt(s[2],10),u[0],u[1],u[2]);return a.getTime()>=f.getTime()}},CTFO.Util.CommonFuns=function(){this.FilterData=function(e,t){var n="",r=Number(e);return r==999999999?n="--":t?n=this.formatTime(e):n=e,n},this.checkPwdMode=function(e){var t=new RegExp("^[_#!$@%^&*()></\\da-zA-Z0-9]*$","g"),n=new RegExp("^[0-9]*$","g"),r=new RegExp("^[a-zA-Z]*$","g"),i=new RegExp("^[_#!@$%^&*()></]*$","g"),s=e.search(t),o=e.search(n),u=e.search(r),a=e.search(i);return s!=-1&&o==-1&&u==-1&&a==-1?!0:!1},this.getTmpl=function(e){var t=CTFO.cache.tmpl[e];if(!t){var t=$.ajax({url:e,async:!1,cache:!0}).responseText;CTFO.cache.tmpl[e]=t}return t},this.initTmpl=function(e,t){var n=CTFO.cache.tmpl[e];n?t(n):$.ajax({url:e,async:!0,cache:!0,complete:function(e,t){},success:function(n){CTFO.cache.tmpl[e]=n,t&&t(n)},error:function(e,t,n){}})},this.initData=function(e){var t=CTFO.cache.data[e.url];!t||e.reload?$.ajax({url:e.url,type:"POST",dataType:"json",data:e.data,complete:function(e,t){},success:function(t,n,r){t&&t.Rows&&t.Rows.length>0&&(CTFO.cache.data[e.url]=t.Rows,e.success&&e.success(t.Rows))},error:function(e,t,n){}}):e.success(t)},this.checkUpFileSize=function(e,t){if(!e)return;var t=t||1048576,n=0;if(e.files&&e.files[0])var n=e.files[0].size;else try{e.select();var r=document.selection.createRange().text,i=new ActiveXObject("Scripting.FileSystemObject"),n=i.GetFile(r).size}catch(s){}return n>=t?!0:!1},this.getClinetHeight=function(e){var t=$.browser.opera?document.body.clientHeight:document.documentElement.clientHeight;return t-e},this.isTransEntUser=function(){return $.inArray(+CTFO.cache.user.entType,[1,2])>-1},this.clearString=function(e){var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）&;|{}【】‘；：”“'。，、？]"),n="";for(var r=0,i=e.length;r<i;r++)n+=e.substr(r,1).replace(t,"");return n},this.hasForbiddenChar=function(e){var t=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）&;|{}【】‘；：”“'。，、？]"),n=!1;for(var r=0,i=e.length;r<i;r++){n=t.test(e.substr(r,1));if(n)break}return n},this.validateCharLength=function(e){var t=0,n=e.split("");for(var r=0,i=n.length;r<i;r++)n[r].charCodeAt(0)<299?t++:t+=2;return t},this.isTel=function(e){var t=/^[0-9]\d{10}$/g.test(e);return t},this.isInt=function(e){if(!e)return!1;var t=/^(-|\+)?\d+$/;return t.test(e)},this.isFloat=function(e){if(!e)return!1;var t=/^(-|\+)?\d+(\.\d+)?$/;return t.test(e)},this.isTime=function(e){if(!e)return!1;var t=e.match(/^(\d{1,2})(:)?(\d{1,2})\2(\d{1,2})$/);return t?t[1]>24||t[3]>60||t[4]>60?!1:!0:!1},this.formatTime=function(e){var t="",n=!1,r=Number(e);r<0&&(r=Math.abs(r),n=!0);var i=r/3600;i=Math.floor(i),i!=0?i<10?t="0"+i+":":t=i+":":t="00:";var s=r%3600,o=s/60;o=Math.floor(o),o!=0?o<10?t=t+"0"+o+":":t=t+o+":":t+="00:";var u=s-o*60;return u!=0?u<10?t=t+"0"+u:t+=u:t+="00",n&&(t="-"+t),t},this.isDate=function(e){var t=e.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(!t)return!1;var n=new Date(t[1],t[3]-1,t[4]);return n.getFullYear()==t[1]&&n.getMonth()+1==t[3]&&n.getDate()==t[4]},this.isTimeStamp=function(e){var t=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2})$/,n=e.match(t);if(!n)return!1;var r=new Date(n[1],n[3]-1,n[4],n[5],n[6],n[7]);return r.getFullYear()==n[1]&&r.getMonth()+1==n[3]&&r.getDate()==n[4]&&r.getHours()==n[5]&&r.getMinutes()==n[6]&&r.getSeconds()==n[7]},this.hoursBetween=function(e,t){if(!e)return-1;if(!t)return-1;var n=e.split(":"),r=t.split(":"),i=parseInt(n[0],10),s=parseInt(n[1],10),o=parseInt(n[2],10),u=parseInt(r[0],10),a=parseInt(r[1],10),f=parseInt(r[2],10),l=(new Date(0,0,0,i,s,o)).getTime(),c=(new Date(0,0,0,u,a,f)).getTime();return parseInt((c-l)/6e4,10)},this.getFifteenDay=function(){var e=new Date,t=new Date(e.getTime()-12096e5),n=t.getMonth()+1,r=t.getDate(),i="";n<10&&(n="0"+n),r<10&&(r="0"+r);var r=t.getYear()+"-"+n+"-"+r;return r},this.trim=function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},this.ltrim=function(e){return e.replace(/(^\s*)/g,"")},this.rtrim=function(e){return e.replace(/(\s*$)/g,"")},this.initSelectsFromServer=function(e){$.ajax({url:e.url,type:"post",dataType:"json",data:e.params,error:function(){},success:function(t){var n=['<option value="" title="请选择...">请选择...</option>'],r=t&&t[e.key]?t[e.key]:t;$(r).each(function(){var t="";this[e.code||"code"]==e.selectedCode&&(t="selected"),n.push('<option value="'+this[e.code||"code"]+'" title="'+this[e.name||"name"]+'" '+t+">"+this[e.name||"name"]+"</option>")}),$(e.container).html("").append(n.join(""))}})},this.initNoSelectsFromServer=function(e){$.ajax({url:e.url,type:"post",dataType:"json",data:e.params,error:function(){},success:function(t){var n=[],r=t[e.key]?t[e.key]:t;$(r).each(function(){var t="";this[e.code||"code"]==e.selectedCode&&(t="selected"),n.push('<option value="'+this[e.code||"code"]+'" title="'+this[e.name||"name"]+'" '+t+">"+this[e.name||"name"]+"</option>")}),$(e.container).html("").append(n.join(""))}})},this.getCityByLngLat=function(e,t,n,r){if(!e||!t)return!1;var i={location:e+" "+t,type:1},s=new TMServiceGC;s.rgcEncoding(i,function(e){if(+e.resultCode!==1)return!1;var t=n==="code"?e.resultInfo.city.code:e.resultInfo.city.name;t&&r&&r(t)})},this.getAddressByLngLat=function(e,t,n,r,i,s){if(!e||!t)return!1;n=n||6;var o={location:e+" "+t,type:n},u=new TMServiceGC;(function(e){u.rgcEncoding(o,function(t){if(+t.resultCode===1){var n="",s=t.resultInfo;s.point?s.point.name&&(n+=s.point.address+s.point.name):(s.district&&(n+=s.district.city.name+s.district.county.name),s.road&&(n+=s.road.name)),n||(n="未知位置");if(e)CTFO.cache.batchTrackingLocationData[e]=n;else if(i)$(r).attr("title",n).html(n);else{$(r).append("<span></span>").addClass("cutText").text(n).attr("title",n);var o=setTimeout(function(){$(r).find("span").remove(),$(r).text("获取位置"),$(r).show(),clearTimeout(o)},3e5)}}})})(s)},this.getAddressByLngLat2=function(e,t,n,r){$.ajax({url:CTFO.config.sources.findAddressBySync,type:"POST",dataType:"json",data:{"requestParam.equal.lon":e,"requestParam.equal.lat":t},complete:function(e,t){},success:function(e,t,n){$(r).append("<span></span>").addClass("cutText").text(e.address).attr("title",e.address)},error:function(e,t,n){}})},this.getVehicleLatestInfo=function(e){var t={"requestParam.equal.enableFlag":1};e.vid&&(t["requestParam.equal.vid"]=e.vid),e.vehicleNo&&(t["requestParam.equal.vehicleNo"]=e.vehicleNo);if(e.vehicleNo=="车牌号"||e.vehicleNo==""||CTFO.utilFuns.commonFuns.hasForbiddenChar(e.vehicleNo))return $.ligerDialog.alert("请输入正确车牌号","提示","error"),!1;$.ajax({url:CTFO.config.sources.getVehicleLatestInfo,type:"POST",dataType:"json",data:t,complete:function(e,t){},success:function(t,n,r){t&&t.length>0&&t[0].maplon&&e.callback?e.callback(t[0]):$.ligerDialog.error("地图范围内没有找到该车辆")},error:function(e,t,n){}})},this.getAlarmLevelIcon=function(e){var t="img/alarmLevel/level"+e+".png";if(!e||"012".indexOf(e)<0)t="img/alarmLevel/level0.png";return e=="stop"&&(t="img/alarmLevel/stopPoint.png"),t},this.getColorDesc=function(e){var t=["蓝色","黄色","黑色","白色"];return t[e-1]||(+e===9?"其他":"")},this.oldDirection=0,this.getCarDirectionIconByLngLat=function(e,t,n){var r="img/vehicleDirection/",i=parseFloat(e[0]),s=parseFloat(e[1]),o=parseFloat(e[2]),u=parseFloat(e[3]);if(n==="true"||+n===1)r+="online-";else if(n==="false"||+n===0)r+="offline-";return Math.abs(t-this.oldDirection)<30&&(t=this.oldDirection),this.oldDirection=t,15>t||t>=345?r+="0":15<=t&&t<45?r+="30":45<=t&&t<75?r+="60":75<=t&&t<105?r+="90":105<=t&&t<135?r+="120":135<=t&&t<165?r+="150":165<=t&&t<195?r+="180":195<=t&&t<225?r+="210":225<=t&&t<255?r+="240":255<t&&t<285?r+="270":285<=t&&t<315?r+="300":315<=t&&t<345?r+="330":r+="0",r+=".png",r},this.getCarDirectionIcon=function(e,t,n,r,i,s){var o="img/vehicleDirection/";CTFO.cache.vehicleMarkerType===2&&(o+="v-");var u=parseFloat(e);u===360&&(u=0);if(t==="false"||+t===0)o+="offline-";else if(t==="true"||+t===1)!i&&typeof i=="undefined"?o+="c-online-":+n===1?o+="alarm-":+r>5?o+="online-":o+="stopping-";return 15>e||e>=345?o+="0":15<=e&&e<45?o+="30":45<=e&&e<75?o+="60":75<=e&&e<105?o+="90":105<=e&&e<135?o+="120":135<=e&&e<165?o+="150":165<=e&&e<195?o+="180":195<=e&&e<225?o+="210":225<=e&&e<255?o+="240":255<e&&e<285?o+="270":285<=e&&e<315?o+="300":315<=e&&e<345?o+="330":o+="0",o+=".png",o},this.getCarDirectionDesc=function(e,t){var n="";return e=parseFloat(e,10),e===360&&(e=0),255<e&&e<=285?n="正西":285<e&&e<=345?n="西北":345<e||e<=15?n="正北":15<e&&e<=75?n="东北":75<e&&e<=105?n="正东":105<e&&e<=165?n="东南":165<e&&e<=195?n="正南":195<e&&e<=255?n="西南":n="未知",n},this.initScheduleMessage=function(e){if(!CTFO.cache.schedulePreMessage||CTFO.cache.schedulePreMessage.length<1)return!1;var t=["<option value='' >请选择...</option>"];$(CTFO.cache.schedulePreMessage).each(function(e){var n="<option value='"+this.msgBody+"' >"+this.msgIdx+"</option>";t.push(n)}),$(e).append(t.join(""))},this.validateText=function(e){var t=!0,n="/,{,},(,)".split(",");e||(t=!1);for(var r=n.length-1;r>0;r--)if(e.indexOf(n[r])>-1){t=!1;break}return t},this.null2blank=function(e){return!e||e.toLowerCase()==="null"?"":e},this.getFlashObj=function(e){var t=null;return navigator.appName.indexOf("Microsoft Internet")==-1?document.embeds&&document.embeds[e]?t=document.embeds[e]:t=window.document[e]:t=window[e],t||(t=document.getElementById(e)),t},this.resetGrid=function(e){e.options.newPage=1,e.options.page=1},this.exportGrid=function(e){if(!e.grid||typeof e.grid!="object")return!1;if(e.grid.getData().length===0)return $.ligerDialog.alert("请确认查询结果不为空","信息提示","warn"),!1;var t=1500,n=!1,r={width:300,height:120,title:"导出向导",url:CTFO.config.template.exportWindow,onLoad:function(e,t,n){s(e,t,n)},data:e},i=$("<div>");$(i).applyCtfoWindow(r);var s=function(e,r,i){var s={param:r.grid.options.parms,columns:r.grid.options.columns,pageSize:r.grid.options.pageSize,sortName:r.grid.options.sortName,sortOrder:r.grid.options.sortOrder};$(e).find(".exportButton").click(function(i){if(n)return!1;var a=$(e).find(".errorTip"),f=$(e).find("input[name=fromPage]").val(),l=$(e).find("input[name=toPage]").val(),c=+l- +f+1,h=c*s.pageSize;l=parseInt(l,10),f=parseInt(f,10);if(!f||!l||isNaN(f)||isNaN(l))return a.text("输入的页码值需为整数"),!1;if(l<f)return a.text("结束页码值需大于起始页码值"),!1;if(h>t)return a.text("导出数据过量, 请重新输入导出范围<br>请不要一次性导出"+t+"条以上的数据"),!1;n=!0,a.text("正在导出, 请耐心等待...");var p=[{name:"requestParam.page",value:f},{name:"requestParam.pagesize",value:c},{name:"requestParam.rows",value:s.pageSize},{name:s.sortName,value:s.sortOrder||"asc"},{name:"requestParam.equal.sortname",value:s.sortName},{name:"requestParam.equal.sortorder",value:s.sortOrder||"asc"}],v=r.columnsTextWanted||u(s.columns);r.isActiveMonitorVehicles?p={"requestParam.equal.idArrayStr":r.vids,"requestParam.equal.DataHeader":v}:(p.push({name:"exportDataHeader",value:v}),$.merge(p,s.param)),o(r.url,a,p)})},o=function(e,t,n){$.ajax({url:e,type:"POST",dataType:"json",data:n,complete:function(e,t){},success:function(e,n,r){if(e&&e.error||e&&e.msg==="error")return t.text("导出出错"),!1;var i=e.msg||"";i||t.text("导出出错"),t.html("<a href=\"javascript:void(0)\" onclick=\"document.getElementById('exportGridFrame').src='"+i+"';\">请点击下载</a>")},error:function(e,n,r){t.text("导出出错")},timeout:3e5})},u=function(e){var t=[];return $(e).each(function(e){var n=["操作","图表","序号","违规照片","位置/轨迹","油量变化详情"],r=this.display;if(!this.hide&&$.inArray(r,n)<0){var i=this.columns,s=i?"_1=":"=";t.push(this.name+s+r),i&&$(i).each(function(e){this.hide||t.push(this.name+"_2="+this.display)})}}),t.join("&")}},this.getCustomColumns=function(e,t){var n=null,r=[];return $.ajax({url:CTFO.config.sources.findPageDisColumn+"?reportId="+e,type:"POST",dataType:"json",async:!1,complete:function(e,t){},success:function(e,i,s){n=e;var o=[],u=[];if(n&&n.length>0){for(var a=0;a<t.length;a++)if(t[a].frozen)r.push(t[a]);else if(t[a].operate)u.push(t[a]);else for(var f=0;f<n.length;f++)if(t[a]&&t[a].name&&n[f].codeId&&t[a].name===n[f].codeId){o.push(t[a]);break}var l=!1,c=0,h=0;for(var p=0;p<n.length;p++){for(var d=0;d<o.length;d++)if(n[p].codeId&&o[d]&&o[d].name&&n[p].codeId===o[d].name){l=!0,c=d;break}if(l){var v=o[h];o[h]=o[c],o[c]=v,h++,l=!1}}r=r.concat(o,u)}else for(var a=0;a<t.length;a++)if(t[a].frozen)r.push(t[a]);else if(t[a].operate)r.push(t[a]);else{if(t[a].showType&&t[a].showType==="hidden")continue;r.push(t[a])}},error:function(e,t,n){}}),r},this.setCustomColumns=function(e,t,n){if(!e)return!1;var r={width:450,height:360,title:"自定义列",url:CTFO.config.sources.customColumns+"?reportId="+e,onLoad:function(e,t,n){s(e,t,n)},data:{id:e,grid:t,allColumns:n}},i=$("<div>");$(i).applyCtfoWindow(r);var s=function(e,t,n){if(!customColumns)return!1;var r=customColumns[t.id];u(r,t.allColumns),a(e,t,n,r)},o=function(e){var t=!1;return $.ajax({url:CTFO.config.sources.delCustomColumns+"?reportId="+e,type:"POST",dataType:"json",async:!1,complete:function(e,t){},success:function(e,n,r){"1"==e&&(t=!0)},error:function(e,t,n){}}),t},u=function(e,t){var n=$("#leftSel").children()||[],r=$("#rightSel").children()||[],i=n.length,s=r.length,o=[],u=[];$.merge(n,r);var a=$.map(n,function(e,t){if(!e)return"";var n=e.innerHTML,n=n.replace(/[\r\n]/g,""),n=$.trim(n);return n});$(e).each(function(e){var n=this.text,r=this.name,f=this.id||"",l=this.showType;for(var c=0;c<t.length;c++)if(r==t[c].name){l=t[c].showType;break}var h=!1;if(s>0)for(var c=0;c<s.length;c++)if(r==s[c].name){h=!0;break}if($.inArray(n,a)<0){var p='<option id="'+f+'" name="'+r+'">'+n+"</option>";i==0&&s==0?l==="hidden"?o.push(p):u.push(p):h||o.push(p)}}),$("#leftSel").append(o.join("")),$("#rightSel").append(u.join(""))},a=function(e,t,n,r){$(e).find(".moveToSelect").click(function(e){$("#leftSel option:selected").appendTo("#rightSel")}).end().find(".moveToUnSelect").click(function(e){$("#rightSel option:selected").appendTo("#leftSel")}).end().find(".moveUp").click(function(e){var t=$("#rightSel option:selected");$(t[0]).insertBefore($(t[0]).prev())}).end().find(".moveDown").click(function(e){var t=$("#rightSel option:selected");$(t[0]).insertAfter($(t[0]).next())}).end().find(".saveButton").click(function(r){c(e,t,n)}).end().find(".resetButton").click(function(n){$(e).find(".moveToSelect").attr("disabled","disabled"),$(e).find(".moveToUnSelect").attr("disabled","disabled"),$(e).find(".moveUp").attr("disabled","disabled"),$(e).find(".moveDown").attr("disabled","disabled"),$(e).find(".saveButton").attr("disabled","disabled"),$(e).find(".resetButton").attr("disabled","disabled"),$(e).find(".cancelButton").attr("disabled","disabled"),$(e).find(".l-dialog-winbtn").attr("disabled","disabled"),f(r,t.allColumns,t.id,t.grid,e)}).end().find(".cancelButton").click(function(e){n.close()}).end()},f=function(e,t,n,r,i){$.ligerDialog.confirm("确定要恢复默认值吗？",function(s){if(s){$("#leftSel").html(""),$("#rightSel").html("");var a=o(n);if(a){u(e,t);var f=[];for(var l=0;l<t.length;l++)t[l].showType!="hidden"&&f.push(t[l]);r.setOptions({columns:f}),r.loadData()}}$(i).find(".moveToSelect").removeAttr("disabled"),$(i).find(".moveToUnSelect").removeAttr("disabled"),$(i).find(".moveUp").removeAttr("disabled"),$(i).find(".moveDown").removeAttr("disabled"),$(i).find(".saveButton").removeAttr("disabled"),$(i).find(".resetButton").removeAttr("disabled"),$(i).find(".cancelButton").removeAttr("disabled"),$(i).find(".l-dialog-winbtn").removeAttr("disabled")})},l=function(e){var t=$("#leftSel").children(),n=$("#rightSel").children(),r=[],i=[],s=[];return $(t).each(function(e){var t=$.trim($(this).text()),n=$(this).attr("name"),i=$(this).attr("id");r.push(i+":"+n+":"+t+":0:"+(e+1))}),$(n).each(function(e){var t=$.trim($(this).text()),n=$(this).attr("name"),r=$(this).attr("id");i.push(r+":"+n+":"+t+":1:"+(e+1)),s.push(n)}),$.merge(r,i),[r,s]},c=function(e,t,n){var r=l(e),i={reportId:t.id,columnArr:r[0].join("!")};$.ajax({url:CTFO.config.sources.updateCustomColumns,type:"POST",dataType:"json",async:!1,data:i,complete:function(e,t){},success:function(e,i,s){if(+e!==1)return $.ligerDialog.success("保存失败！"),!1;$.ligerDialog.success("保存成功！");var o=r[1],u=[],a=[],f=[];if(o){for(var l=0;l<t.allColumns.length;l++)if(1==t.allColumns[l].frozen)u.push(t.allColumns[l]);else if(t.allColumns[l].operate==1)f.push(t.allColumns[l]);else for(var c=0;c<o.length;c++)if(t.allColumns[l].name==o[c]){a.push(t.allColumns[l]);break}var h=!1,p=0,v=0;for(var m=0;m<o.length;m++){for(var y=0;y<a.length;y++)if(o[m]==a[y].name){h=!0,p=y;break}if(h){var b=a[v];a[v]=a[p],a[p]=b,v++,h=!1}}u=u.concat(a,f)}else for(var l=0;l<t.allColumns.length;l++)1==t.allColumns[l].frozen?u.push(t.allColumns[l]):t.allColumns[l].operate==1&&u.push(t.allColumns[l]);t.grid.setOptions({columns:u}),t.grid.loadData(),n.close()},error:function(e,t,n){$.ligerDialog.success("保存失败！")}})}},this.defaultFocusDesign=function(e){for(var t=0;t<e.length;t++){var n=e[t].name,r=e[t].value;(function(e,t){$(e).focus(function(e){var n=$(this).val();(!n||n==t)&&$(this).val("")}).blur(function(e){var n=$(this).val();(!n||n==t)&&$(this).val(t)})})(n,r)}}},CTFO.Util.Commands=function(){this.sendCommands=function(e,t,n){if(!e)return!1;var r="";switch(e){case"message":r=n.isBatchMessage?CTFO.config.sources.batchMessageCommand:CTFO.config.sources.singleMessageCommand;break;case"photo":r=n.isBatchPhoto?CTFO.config.sources.batchPhotoCommand:CTFO.config.sources.photoCommand;break;case"calling":r=CTFO.config.sources.callingCommand;break;case"taping":r=CTFO.config.sources.tapingCommand;break;case"tracking":r=CTFO.config.sources.emphasisCommand;break;case"checkroll":r=CTFO.config.sources.checkrollCommand;break;case"unchainAlarm":r=CTFO.config.sources.unchainAlarm}$.ajax({url:r,type:"POST",dataType:"json",data:t,complete:function(e,t){},success:function(e,t,r){n.callback&&n.callback(e,n)},error:function(e,t,r){n.callback&&n.callback(null,n)}})},this.getCommandStatus=function(e,t){$.get(CTFO.config.sources.commandStatus,{"requestParam.equal.coSeq":e},function(e,n,r){if(e&&e.error)return!1;$(t).html(e[0].seq)},"json")}},CTFO.Util.throttle=function(e,t,n){var r={timer:null,t_start:0,context:null,args:null,act:function(e,r){var i=+(new Date);clearTimeout(this.timer),this.t_start||(this.t_start=i),this.context=e,this.args=r,i-this.t_start>=n?this.done():this.timer=setTimeout(this.timerHandler,t)},done:function(){e.apply(this.context,this.args),this.t_start=0},timerHandler:function(){r.done()}};return function(){r.act(this,arguments)}},CTFO.Util.Map=function(e){var t={center:[116.29376,39.95776],level:4},n={map:null,pointMarkerObj:{},markerObj:{},markerLblObj:{},markerLockObj:{},markerTipObj:{},currentTipId:"",polyLineObj:{},rectObj:{},polygonObj:{},circleObj:{},ellipseObj:{},markerIdCache:[],polylineIdCache:[],rectIdCache:[],polygonIdCache:[],circleIdCache:[],ellipseIdCache:[],init:function(e){if(!e.container||$("#"+e.container).length<1)return!1;var n=this;e=$.extend({},t||{},e||{}),this.map=new TMMaps(e.container),this.map.closeHighlight(),this.map.centerAndZoom(new TMLngLat(e.center[0],e.center[1]),+e.level),this.map.handleMouseScroll(!0),this.map.enableDoubleClickZoom(),this.map.addControl(new TMMapControl(1,!0));var r=[],i=[{id:"zoomIn",text:"放大",fun:function(){n.map.zoomIn()}},{id:"zoomOut",text:"缩小",fun:function(){n.map.zoomOut()}}];return $(i).each(function(e){var t=new TMMenuItem;t.id=this.id,t.menuText=this.text,t.functionName=this.fun,e>0&&(t.separateLine=!0),r.push(t)}),this.map.addMenuControl(new TMMenuControl(r)),this},addMapControl:function(e){var t;e&&"1,2,3,4".indexOf(e)>-1?t=new TMMapControl(e):t=new TMMapControl,this.map.addControl(t)},addScaleControl:function(){this.map.addControl(new TMScaleControl)},addCenterCrossControl:function(){this.map.addControl(new TMCenterCrossControl)},addMapCopyRight:function(e){var t=new TMCopyrightControl;t.addCopyright({id:1,content:"<span style='color:blue;font-size:12px;'>&copy;2012 TransWiseway - 审图号GS(2010)1367号  - 甲测资质11002076</span>",bounds:new TMLngLatBounds([new TMLngLat(10,30),new TMLngLat(160,80)])}),t.setRight(e.right?e.right:160),t.setBottom(e.bottom?e.bottom:10),this.map.addControl(t)},addOverviewMapControl:function(e){this.minmap||(this.minmap=new TMOverviewMapControl(null,[200,150],null,null,3)),this.map.addControl(this.minmap),e||this.minmap.changeView()},addMarker:function(e){var t=this;this.markerObj||(this.markerObj={}),this.markerLblObj||(this.markerLblObj={});var n={iconUrl:"img/monitor/map/markerIcon/marker.png",iconW:20,iconH:20,anchor:[10,10],labelAnchor:[0,0],labelFontSize:10,labelBgColor:"#545454",labelFontColor:"#FFFFFF",isDefaultTip:!0,isOpen:!1,isEdit:!1,isMultipleTip:!1,eventType:"click"};e=$.extend({},n||{},e||{});var r=null,i=null,s=null,o=null,u=new TMIcon(e.iconUrl,new TMSize(e.iconW,e.iconH)),a=new TMLngLat(e.lng,e.lat);if(!this.markerObj[e.id]){var f=new TMMarkerOptions;f.lnglat=a,f.icon=u,f.offset=new TMPoint(e.anchor[0],e.anchor[1]),r=new TMMarkerOverlay(f),this.markerObj[e.id]=r,e.zIndex&&r.setZindex(e.zIndex,e.zIndex),e.onDragend&&(r.setEditable(!0),TMEvent.addListener(r,"dragend",e.onDragend)),this.addOverLay(r),this.markerIdCache.push(e.id);if(e.label){var l=new TMTextOptions;l.lnglat=a,l.text=e.title?e.title:e.label,l.editable=!1,l.fontSize=e.labelFontSize,l.bgColor=e.labelBgColor,l.offset=new TMPoint(e.labelAnchor[0],e.labelAnchor[1]),i=new TMTextOverlay(l),e.zIndex&&i.setZindex(e.zIndex,e.zIndex),this.markerLblObj[e.id]=i,this.addOverLay(i)}if(e.isDefaultTip&&e.tip)o=e.tip;else if(!e.isDefaultTip&&e.tip){var c=new TMHtmlOptions;c.lnglat=a,c.content=e.tip,o=new TMHtmlOverlay(c)}return!this.markerTipObj[e.id]&&o&&(this.markerTipObj[e.id]=o),e.handler?TMEvent.addListener(r,e.eventType,e.handler):o&&(e.isDefaultTip?TMEvent.addListener(r,e.eventType,function(n){t.markerTipObj[t.currentTipId]&&!e.isMultipleTip&&t.markerObj[t.currentTipId].closeInfoWindow();var r=n.openInfoWindow(e.title||e.label||"",o);if(e.tipCallback){var i=$(r.getObject());e.tipCallback(i,e.lng,e.lat)}}):TMEvent.addListener(r,e.eventType,function(n){t.markerTipObj[e.id]&&t.map.overlayManager.removeOverLay(t.markerTipObj[e.id]),t.markerTipObj[t.currentTipId]&&!e.isMultipleTip&&t.map.overlayManager.removeOverLay(t.markerTipObj[t.currentTipId]),t.markerTipObj[e.id]=o,t.map.overlayManager.addOverLay(o),t.currentTipId=e.id})),o&&e.isOpen&&!e.isDefaultTip?(this.markerTipObj[this.currentTipId]&&!e.isMultipleTip&&this.removeOverLay(t.markerTipObj[t.currentTipId]),this.markerTipObj[e.id]=o,this.addOverLay(o),this.currentTipId=e.id):o&&e.isOpen&&e.isDefaultTip&&(this.markerTipObj[t.currentTipId]&&!e.isMultipleTip&&this.markerObj[t.currentTipId].closeInfoWindow(),r.openInfoWindow(e.title?e.title:e.label,o)),this.markerObj[e.id]}return this.markerObj[e.id]},removeMarker:function(e){if(!this.markerObj||!this.markerObj[e])return!1;this.markerTipObj&&this.markerTipObj[e]&&(typeof this.markerTipObj[e]=="object"?this.removeOverLay(this.markerTipObj[e],!0):this.markerObj[e].closeInfoWindow(),delete this.markerTipObj[e]),this.markerLblObj&&this.markerLblObj[e]&&(this.removeOverLay(this.markerLblObj[e],!0),delete this.markerLblObj[e]),this.markerLockObj&&this.markerLockObj[e]&&delete this.markerLockObj[e],this.removeOverLay(this.markerObj[e],!0),delete this.markerObj[e],this.markerIdCache.splice($.inArray(e,this.markerIdCache),1)},removeAllMarkers:function(){for(var e=this.markerIdCache.length;e--;)this.removeMarker(this.markerIdCache[e])},moveMarker:function(e){if(!this.markerObj||!this.markerObj[e.id])return!1;e.anchor=e.anchor||[2,2];var t=this.markerObj[e.id],n=new TMLngLat(e.lng,e.lat);t.setLngLat(n);if(this.markerTipObj&&this.markerTipObj[e.id]){var r=this.markerTipObj[e.id];typeof r=="object"?r.setLngLat(n):t.closeInfoWindow()}if(e.iconUrl){var i=new TMIcon(e.iconUrl,new TMSize(e.iconW,e.iconH));i.setSrc(e.iconUrl),t.setIcon(i)}if(e.anchor){var s=new TMPoint(e.anchor[0],e.anchor[1]);t.setOffset(s)}this.markerLblObj&&this.markerLblObj[e.id]&&(this.markerLblObj[e.id].setLngLat(n),e.label&&this.markerLblObj[e.id].setText(e.label));if(this.markerLockObj&&this.markerLockObj[e.id]){var o=this.getLevel();this.map.setCenter(n)}return this.markerObj[e.id]},getMarkerLabel:function(e){return this.markerLblObj[e]},getMarker:function(e){return this.markerObj[e]},hideMarkersByIds:function(e){for(var t=e.length;t--;){var n=e[t];that.markerObj[n].setOpacity(0),that.markerLblObj[n]&&that.markerLblObj[n].setOpacity(0),that.markerTipObj[n]&&that.markerTipObj[n].setOpacity(0)}},showMarkersByIds:function(e){for(var t=e.length;t--;){var n=e[t];that.markerObj[n].setOpacity(50),that.markerLblObj[n]&&that.markerLblObj[n].setOpacity(50),that.markerTipObj[n]&&that.markerTipObj[n].setOpacity(50)}},lockMarker:function(e){this.markerLockObj||(this.markerLockObj={}),this.markerLockObj[e]=!0},unlockMarker:function(e){this.markerLockObj[e]&&(this.markerLockObj[e]=!1)},addPolyLine:function(e){var t={strColor:"blue",numWidth:3,numOpacity:.5};if(this.getPolyLine(e.id))return!1;e=$.extend({},t,e||{});if(!e.arrLngLat.length)return!1;if(e.arrLngLat.length%2)throw"arrLngLat%2 != 0";this.polyLineObj||(this.polyLineObj={});var n=[];while(e.arrLngLat.length){var r=e.arrLngLat.splice(0,2);n.push(new TMLngLat(r[0],r[1]))}var i=new TMLineOptions;i.lnglats=n,i.color=e.strColor,i.weight=e.numWidth,i.opacity=e.numOpacity;var s=new TMLineOverlay(i);return this.polyLineObj[e.id]=s,this.addOverLay(s),this.polylineIdCache.push(e.id),s},removePolyLine:function(e){this.polyLineObj&&this.polyLineObj[e]&&(this.removeOverLay(this.polyLineObj[e],!0),delete this.polyLineObj[e],this.polylineIdCache instanceof Array&&this.polylineIdCache.splice($.inArray(e,this.polylineIdCache),1))},getPolyLine:function(e){return this.polyLineObj[e]},removeAllPolyLines:function(){for(var e=this.polylineIdCache.length;e--;){var t=this.polylineIdCache[e];this.removePolyLine(t)}},addRect:function(e){var t={};if(this.getRect(e.id))return!1;e=$.extend({},t,e||{});if(!e.arrLngLat.length)return!1;if(e.arrLngLat.length%2)throw"arrLngLat%2 != 0";this.rectObj||(this.rectObj={});var n=new TMRectOptions,r=new TMLngLatBounds(e.arrLngLat[0],e.arrLngLat[1],e.arrLngLat[2],e.arrLngLat[3]);n.bounds=r,e.weight&&(n.weight=e.weight),e.lineColor&&(n.lineColor=e.lineColor),e.fillColor&&(n.fillColor=e.fillColor),e.lineStyle&&(n.lineStyle=e.lineStyle),e.opacity&&(n.opacity=e.opacity),e.editable&&(n.editable=e.editable);var i=new TMRectOverlay(n);return this.rectObj[e.id]=i,this.addOverLay(i),this.rectIdCache.push(e.id),i},removeRect:function(e){this.rectObj&&this.rectObj[e]&&(this.removeOverLay(this.rectObj[e],!0),delete this.rectObj[e],this.rectIdCache.splice($.inArray(e,this.rectIdCache),1))},getRect:function(e){return this.rectObj[e]},removeAllRects:function(){for(var e=this.rectIdCache.length;e--;){var t=this.rectIdCache[e];this.removeRect(t)}},addPolygon:function(e){var t={strColor:"blue",strBgColor:"",numWidth:3,numOpacity:.5};if(this.getPolygon(e.id))return!1;e=$.extend({},t,e||{});if(!e.arrLngLat.length)return!1;if(e.arrLngLat.length%2)throw"arrLngLat%2 != 0";this.polygonObj||(this.polygonObj={});var n=[];while(e.arrLngLat.length){var r=e.arrLngLat.splice(0,2);n.push(new TMLngLat(r[0],r[1]))}var i=new TMPolygonOptions;i.lnglats=n,i.color=e.strColor,i.bgcolor=e.strBgColor,i.opacity=e.numOpacity;var s=new TMPolygonOverlay(i);return this.polygonObj[e.id]=s,this.addOverLay(s),this.polygonIdCache.push(e.id),s},removePolygon:function(e){this.polygonObj&&this.polygonObj[e]&&(this.removeOverLay(this.polygonObj[e],!0),delete this.polygonObj[e],this.polygonIdCache.splice($.inArray(e,this.polygonIdCache),1))},getPolygon:function(e){return this.polygonObj[e]},removeAllPolygons:function(){for(var e=this.polygonIdCache.length;e--;){var t=this.polygonIdCache[e];this.removePolygon(t)}},addCircle:function(e){var t={lng:null,lat:null,numRadius:500,strColor:"blue",strBgColor:"yellow",numWeight:1,numOpaity:.8};e=$.extend({},t,e);if(!e.lng||!e.lat)return!1;this.circleObj||(this.circleObj={});var n=new TMCircleOptions;n.centerLngLat=new TMLngLat(e.lng,e.lat),n.radius=e.numRadius,n.units="meter",n.lineColor=e.strColor,n.fillColor=e.strBgColor,n.opacity=e.numOpaity,n.weight=e.numWeight;var r=new TMCircleOverlay(n);return this.addOverLay(r),this.circleObj[e.id]=r,this.circleIdCache.push(e.id),r},removeCircle:function(e){this.circleObj&&this.circleObj[e]&&(this.removeOverLay(this.circleObj[e],!0),delete this.circleObj[e],this.circleIdCache.splice($.inArray(e,this.circleIdCache),1))},removeAllCircle:function(){for(var e=this.circleIdCache.length;e--;){var t=this.circleIdCache[e];this.removeCircle(t)}},getLevel:function(){return this.map.getCurrentZoom()},changeSize:function(){this.map.resizeMapDiv()},setLevel:function(e){this.map.zoomTo(e)},setCenter:function(e,t){this.map.setCenterAtLngLat(new TMLngLat(parseFloat(e,10).toFixed(5),parseFloat(t,10).toFixed(5)))},setCenterByLngLat:function(e){this.map.setCenter(e)},zoomIn:function(){this.map.zoomIn()},zoomOut:function(){this.map.zoomOut()},mouseWheelEnabled:function(e){e?this.map.enableHandleMouseScroll(!0):this.map.disableDragHandleMouseScroll(!1)},getBestMap:function(e){if($.type(e)!=="array"||$.type(e[0])==="string"&&e.length%2!==0)return!1;var t=[];if(typeof e[0]=="string"||typeof e[0]=="number")while(e.length){var n=e.splice(0,2);t.push(new TMLngLat(parseFloat(n[0]),parseFloat(n[1])))}else t=e;this.map.getBestMap(t)},getCenterPoint:function(){return this.map.getCenterPoint()},getLngLatBounds:function(){var e=this.map.getLngLatBounds(),t=e.XminNTU/1e5,n=e.YminNTU/1e5,r=e.XmaxNTU/1e5,i=e.YmaxNTU/1e5;return t+","+n+";"+r+","+i},removeAll:function(){this.map.clearOverLays()},changeView:function(){this.minmap.changeView()},panTo:function(e,t){var n=new TMLngLat(e,t);this.map.moveToCenter(n)},fromLngLatToContainerPixel:function(e){var t=this.map.fromLngLatToContainerPixel(e);return t},addOverLay:function(e){this.map.overlayManager.addOverLay(e)},removeOverLay:function(e){this.map.overlayManager.removeOverLay(e,!0)},containsPoint:function(e){return this.map.getLngLatBounds().containsBounds(e)}};return n.init(e)},CTFO.Util.MapTool=function(){var e=function(e){var t={},n=null,r=null,i=null,s=null,o=null,u=null,a=null,f=null,l=!0,c=[{buttonType:"movemap",icon:"ico157",name:"拖动",title:"拖动地图",appendToType:0,callback:m},{buttonType:"zoomin",icon:"ico158",name:"拉框放大",title:"拉框放大",appendToType:0,callback:m},{buttonType:"zoomout",icon:"ico159",name:"拉框缩小",title:"拉框缩小",appendToType:0,callback:m},{buttonType:"cover",icon:"ico160",name:"测面",title:"测面",appendToType:0,callback:m},{buttonType:"distance",icon:"ico161",name:"测距",title:"测距",appendToType:0,callback:m},{buttonType:"savemap",icon:"ico162",name:"保存",title:"保存",appendToType:0,callback:m}],h=function(e){var t=[];return e.appendToType===0?t=['<li class=" cl h20 lh25 hand '+e.buttonType+'" btype="'+e.buttonType+'" title="'+e.title+'">','<span class="'+e.icon+'"></span><font>',e.name,"</font></li>"]:e.appendToType===2?t=['<div class="w120 lh25 fl hand '+e.buttonType+'" title="'+e.title+'">','<span class="'+e.icon+'"></span><font>',e.name,"</font></div>"]:e.appendToType===1?t=['<div class="w80 lh25 fl hand mr10 '+e.buttonType+'" title="'+e.title+'">','<span class="'+e.icon+'"></span><font>',e.name,"</font></div>"]:e.appendToType===3&&(t=['<div class=" fr h25 lh25 pt3 hand mr20 w70 '+e.buttonType+'" title="'+e.title+'">','<span class="'+e.icon+'"></span><font>',e.name,"</font></div>"]),t.join("")},p=function(e){e.appendToContainer.prepend(h(e));var n=t.maptoolContainer.find("."+e.buttonType);d(n),e.callback&&e.callback(n,e.buttonType)},d=function(e){e.hover(function(){$(this).addClass("cBlue")},function(){$(this).removeClass("cBlue")})},v=function(e){$(c.reverse()).each(function(e,n){this.appendToContainer=t.defaultButtonsContainer,this.appendToType=t.defaultButtonType||0,this.callback=m;var r=this;p(r)}),t.maptoolContainer.find(".moreButton").click(function(){w(this)})},m=function(e,t){$(e).click(function(e){g(t)})},g=function(e){if(e==r)return;i&&(i.close(),i=null);switch(e){case"movemap":i&&i.close();break;case"zoomin":i=new TMZoomTool(n,!1),TMEvent.bind(i,"draw",i,y);break;case"distance":var t=new TMLineToolOptions;t.map=n,t.editable=!0,i=new TMDistanceTool(t);break;case"zoomout":i=new TMZoomTool(n,!0),TMEvent.bind(i,"draw",i,y);break;case"cover":var o=new TMAreaToolOptions;o.map=n,i=new TMAreaTool(o);break;case"savemap":i=new TMMapSnap(n)}i?(i.open(),r=e,s=i):b(),E()},y=function(e){i&&(i.close(),i=null,n.setMapCursor(_map_cur[0],_map_cur[1]))},b=function(){r="movemap",$(document.body).unbind("click")},w=function(e){l&&(t.moreButtonsContainer.removeClass("none"),l=!1,e&&(e=$(e),t.moreButtonsContainer.css({top:e.height()}),setTimeout(function(){$(document.body).click(function(e){if($(e.target).hasClass("moreButton"))return!1;t.moreButtonsContainer.addClass("none"),l||(l=!0),$(document.body).unbind("click")})},10)))},E=function(){l||(t.moreButtonsContainer.addClass("none"),l=!0)},S=function(e){return t=$.extend({},t||{},e||{}),n=t.cMap,v(t.moreButtonsContainer),this};this.addButton=p,S(e)};return e}(),CTFO.Util.Events=function(){var e,t,n,r,i,s,o;n={},o=this,e=function(e,t){var r,i;return r=(i=n[e])!=null?i:n[e]=[],r.push(t)},r=function(t,n){return i(t),e(t,n)},i=function(e){var t;return(t=n[e])!=null?t.length=0:void 0},s=function(){var t,u,a,f,l,c;c=Array.prototype.shift.call(arguments),u=(l=n[c])!=null?l:n[c]=[];for(a=0,f=u.length;a<f;a++){t=u[a];if(t.apply(o,arguments)===!1)return!1}return{listen:e,one:r,remove:i,trigger:s}}},function(e){e.fn.applyCtfoMessageListBox=function(t){var n={htmlFrame:"model/template/message_list_box.htm",header:!0,footer:!0,header_title:"提示信息",footer_title:"更多",footer_action:"javascript:void(0);",header_icon:"ioc110",header_css:0,header_css_options:["lineS06c radius3 bcFFF mb10","lineS69c radius3 bcFFF mb10"],title_css:0,title_css_options:["tit1 h30 lh25 pl10","tit2 h30 lh25 pl10"],title_desc:0,title_desc_options:["cFFF pt3 fb","pt3 fb"],tabs:""};this.each(function(r){t=e.extend({},n,t||{});var i={init:function(){var n=t.footer?'<div class=" pr10 h25 lh25 tr cC00"><a href="'+t.footer_action+'">'+t.footer_title+"</a></div>":"",r=['<div class="'+t.header_css_options[t.header_css]+' messageListHeader">','<div class="'+t.title_css_options[t.title_css]+'">','<h3 class="'+t.title_desc_options[t.title_desc]+'"><span class="'+t.header_icon+'"></span>'+t.header_title+"</h3>","</div>",'<div class="messageListContent">',"</div>",n,"</div>"];i.window=e(r.join("")),i.window.content=e(".messageListContent",i.window),i.window.header=e(".messageListHeader",i.window)}};e(this).append(i.window)})}}(jQuery),function(e){e.fn.applyCtfoWindow=function(t){var n={htmlFrame:"model/template/window.html",title:"提示信息",ico:"",width:800,height:600,top:document.body.offsetHeight/2,left:document.body.offsetWidth/2,footer:"",container:"body",mask:!0};this.each(function(){t=e.extend({},n,t||{});var r=this,i={loading:function(){var n=e('<div class="windowBox l-dialog user-defined-dialog"></div>');i.window=n,i.window.append('<div class="tit1 cFFF overh l-dialog-tc-inner"><div class="l-dialog-icon '+t.icon+'"></div><h3 class="l-dialog-title">'+t.title+'</h3><div class="l-dialog-winbtns"><div class="l-dialog-winbtn l-dialog-close"></div></div></div><div class="l-dialog-body"><div class="l-dialog-image"></div><div class="l-dialog-content"></div><div class=" bcBlue l-dialog-buttons"><div class="l-dialog-buttons-inner"></div></div></div>'),i.window.content=e(".l-dialog-body",i.window),i.window.header=e(".l-dialog-tc-inner",i.window);if(t.url)e(i.window.content).load(t.url,{},function(){var n=e(i.window);i.init(n),t.onLoad&&t.onLoad(n,t.data,i)});else if(t.content){e(i.window.content).html(t.content);var r=e(i.window);i.init(r),t.onLoad&&t.onLoad(r,t.data,i)}},init:function(n){i.switchWindow(n[0]),e(t.container).append(n),i.window.show(),t.mask&&i.mask(n),t.left&&n.css("left",t.left-t.width/2),t.right&&n.css("right",t.right),t.top&&n.css("top",t.top-t.height/2),t.bottom&&n.css("bottom",t.bottom),t.width&&n.width(t.width).find(".l-dialog-title").width(t.width-75).end().find(".tip_window_content").width(t.width-2).end().find(".tip_window_footer_center").width(t.width-16),t.height&&i.window.content.height(t.height-28),t.title&&e(".l-dialog-title",i.window.header).html(t.title),e.fn.ligerDrag&&n.ligerDrag({handler:".l-dialog-title",onStartDrag:function(){i.switchWindow(n[0]),n.addClass("l-window-dragging"),i.window.content.children().hide()},onStopDrag:function(){n.removeClass("l-window-dragging"),i.window.content.children().show()}}),e(".l-dialog-close",i.window.header).click(function(){i.close()})},switchWindow:function(t){e(t).css("z-index","65537").siblings(".tip_window").css("z-index","65536")},close:function(){t.onCloseWin&&t.onCloseWin(i.window,t.data,i),i.window.remove(),i.unmask(i.window)},mask:function(t){function r(){if(n.length<1)return;var t=e(window).height()+e(window).scrollTop();n.height(t)}var n=e("body > .user-defined-mask:visible");if(n.length>0)return!1;n.length<1&&(n=e("<div class='l-window-mask user-defined-mask' style='display: block;'></div>").appendTo("body"),e(window).bind("resize.ligeruiwin",r),e(window).bind("scroll",r)),n.show(),r()},unmask:function(t){var n=e("body > .user-defined-dialog:visible"),r=e("body > .user-defined-mask:visible");r&&n.length===0&&r.remove()}},s={};i.loading()})}}(jQuery),function(e){var t=function(t,r){e(t).bind("input propertychange",function(){r.eventTimer&&clearTimeout(r.eventTimer),r.eventTimer=setTimeout(function(){n(t,r)},r.eventTimerDelay)}),e(r.container).on("click",function(n){var i=n.target||window.srcElement,s=e(i).attr("vid"),o=e(i).text();s&&(e(t).val(o),e(t).siblings("input[name="+(r.parseDom||"vehicleId")+"]").val(s),e(r.container).parent().addClass("none"))})},n=function(t,n){var i=e(t).val(),s={"requestParam.equal.entId":n.entId,"requestParam.like.vehicleNo":i};if(i.split("").length<3)return!1;e.ajax({url:n.url,type:"POST",dataType:"json",data:s}).done(function(e){if(!e||e&&!e.Rows||e&&e.Rows&&e.Rows.length<1)return!1;r(e.Rows,n.container)}).fail(function(e){}).always(function(e){})},r=function(t,n){var r=[];e(t).each(function(t,i){t==0&&(e(n).parent().siblings("input[name=vehicleId]").val(this.vid),e(n).parent().siblings("input[name=vehicleNo]").val(this.vehicleNo)),r.push('<li vid="'+this.vid+'">'+this.vehicleNo+"</li>")}),e(n).parent().removeClass("none"),e(n).html(r.join("")),e(n).find("li").hover(function(){e(this).addClass("bcBlue")},function(){e(this).removeClass("bcBlue")}),setTimeout(function(){e(document.body).click(function(t){e(".fuzzyMatchingVehicles").addClass("none"),e(document.body).unbind("click")})},10)},i={init:function(n){return this.each(function(r){var i=e(this),s=i.data("fuzzyMatchingVehicles");n=n||{},n.container||(i.after('<div class="h100 w150 lineS bcFFF  overa abs_left none fuzzyMatchingVehicles" style=" top:25px;z-index:1250;"><ul class="hand"></ul></div><input type="hidden" class="" name="vehicleId" value="">'),n.container=i.siblings(".fuzzyMatchingVehicles").find("ul"));if(typeof s=="undefined"){var o={url:CTFO.config.sources.getMatchingVehicles,entId:CTFO.cache.user.entId,eventTimer:null,eventTimerDelay:1200};s=e.extend({},o,n),i.data("fuzzyMatchingVehicles",s)}else s=e.extend({},s,n);t(i,s)})},destroy:function(){return this.each(function(){$this.removeData("fuzzyMatchingVehicles")})}};e.fn.fuzzyMatchingVehicles=function(){var t=arguments[0];if(i[t])t=i[t];else{if(typeof t!="object"&&!!t)return e.error("Method "+t+" does not exist on jQuery.fuzzyMatchingVehicles"),this;t=i.init}return t.apply(this,arguments)}}(jQuery),CTFO.Model.passwordWindow=function(){function t(){var e={},t=null,n=null,r=function(e){var t=new RegExp("^[_#!$@%^&*()></\\da-zA-Z0-9]*$","g"),n=new RegExp("^[0-9]*$","g"),r=new RegExp("^[a-zA-Z]*$","g"),i=new RegExp("^[_#!@$%^&*()></]*$","g"),s=e.search(t),o=e.search(n),u=e.search(r),a=e.search(i);return s!=-1&&o==-1&&u==-1&&a==-1?!0:!1};window.CommonsLog?cLog=CommonsLog.getInstance():cLog={addOperatorLog:function(){},addMenuLog:function(){}};var i=function(){n=t.validate({rules:{oldPassword:{required:!0},newPassword:{required:!0,rangelength:[7,16],checkInput:[]},newPasswordRepeat:{required:!0,equalTo:"#newPassword"}},messages:{oldPassword:{required:"请输入密码"},newPassword:{required:"请输入新密码",rangelength:"输入字符需要7-16个"},newPasswordRepeat:{required:"请重复输入新密码",equalTo:"两次输入的密码不一致"}}}),$.validator.addMethod("checkInput",function(e,t,n){return r(e)},"字符,字母和数字，至少有两种")},s=function(){if(location.href.indexOf("/index.html")>0)var e="重置密码";else var e="密码过于简单， 请重设您的密码 ";var n={title:e,icon:"icon221",width:400,height:180,url:CTFO.config.template.passwordModify,onLoad:function(e,n,r){t=$(e).find("form[name=passwordModify]"),i(),o(e,r)}};n=n||{};if(n.url||n.content){var r=$("<div>");$(r).applyCtfoWindow($.extend({},n))}},o=function(e,r){t.find("span[name=updatePassword]").bind("click",function(i){var s=n.form();s&&(r.close(e),t.find(".l-dialog-close").trigger("click"),$.ligerDialog.confirm("确定要修改密码？",function(n){if(n){var i=$.trim(t.find("input[name=oldPassword]").val()),s=$.trim(t.find("input[name=newPassword]").val().toLowerCase()),o=$.trim(t.find("input[name=newPasswordRepeat]").val().toLowerCase()),u={oldPassword:hex_sha1(i),retNewPassword:hex_sha1(o)};$.ajax({url:CTFO.config.sources.passwordModify,type:"POST",dataType:"json",data:u,complete:function(e,t){},success:function(t,n,i){t&&t.error&&t.error[0].errorMessage?(cLog.addOperatorLog({opId:CTFO.cache.user.opId,opName:CTFO.cache.user.opName,entId:CTFO.cache.user.entId,entName:CTFO.cache.user.entName,funCbs:CTFO.cache.systemType,funId:"",opType:"修改密码",logTypeId:"SYSOPERATE",logClass:"CTFO.Model.FrameManager",logMethod:"modifyPassword",logDesc:"操作失败"}),$.ligerDialog.error(t.error[0].errorMessage)):(cLog.addOperatorLog({opId:CTFO.cache.user.opId,opName:CTFO.cache.user.opName,entId:CTFO.cache.user.entId,entName:CTFO.cache.user.entName,funCbs:CTFO.cache.systemType,funId:"",opType:"修改密码",logTypeId:"SYSOPERATE",logClass:"CTFO.Model.FrameManager",logMethod:"modifyPassword",logDesc:"操作成功"}),$.ligerDialog.success(t.displayMessage)),r.close(e)},error:function(t,n,i){cLog.addOperatorLog({opId:CTFO.cache.user.opId,opName:CTFO.cache.user.opName,entId:CTFO.cache.user.entId,entName:CTFO.cache.user.entName,funCbs:CTFO.cache.systemType,funId:"",opType:"修改密码",logTypeId:"SYSOPERATE",logClass:"CTFO.Model.FrameManager",logMethod:"modifyPassword",logDesc:"操作失败"}),$.ligerDialog.error("修改密码失败"),r.close(e)}})}}))})};return{popResetPasswordWin:function(t){e=$.extend({},e||{},t||{}),s()}}}var e;return{getInstance:function(){return e||(e=t()),e}}}();